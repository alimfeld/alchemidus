<html>
  <head>
    <title>Alchemidus</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="icons/apple-touch-icon.png" rel="apple-touch-icon">
    <link href="icons/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
    <link href="icons/apple-touch-icon-167x167.png" rel="apple-touch-icon" sizes="167x167">
    <link href="icons/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180">
    <link href="icons/icon-hires.png" rel="icon" sizes="192x192">
    <link href="icons/icon-normal.png" rel="icon" sizes="128x128">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous">
    </script>
    <script src="bundle.js"></script>
    <script>
var game;

function dice(dice) {
  var content;
  var span = $("<span class='dice'></div>");
  content = "&#" + (9855 + dice.face1) + ";";
  if (dice.areTwo()) {
    content += "&#" + (9855 + dice.face2) + ";";
  }
  span.append(content);
  return span;
}

function newGame() {
  clearSteps();
  game = new Game();
  var cnt = 1;
  game.operations.forEach(op => {
    var div = $("<div class='layout'></div>");
    var header = $("<div class='header'></div>");
    var main = $("<div class='main'></div>");
    var footer = $("<div class='footer'></div>");
    header.append("<div class='cost'>" + op.cost + "</div>");
    var type;
    switch(op.type) {
      case 'R': type = 'Remove'; break;
      case 'G': type = 'Get'; break;
      case 'C': type = 'Change'; break;
    }
    header.append("<div class='type'>" + type + "</div>");
    header.append("<div class='id'>" + op.id + "</div>");
    var description = op.description;
    description = description.replace(/(&#x268.;)/g, "<span class='die'>$1</span>");
    main.append("<div>" + description + "</div>");
    div.append(header);
    div.append(main);
    div.append(footer);
    $("#c" + cnt++).html(div);
  });
  $("#clay").html(dice(game.start));
  $("#iron").html(dice(game.targets[0]));
  $("#gold").html(dice(game.targets[1]));
}

function clearSteps() {
  for (var i = 1; i <= 15; i++) {
    $("#c" + i + " .footer").empty();
  }
}

function showStep(step, transition, cost, remaining) {
  var op = transition.operation;
  var card = game.operations.indexOf(op) + 1;
  var footer = $("#c" + card + " .footer");
  footer.append("<div class='step'>" + step + "</div>");
  footer.append("<div class='cost'>" + cost + "</div>");
  var state = $("<div class='state'></div>");
  state.addClass("remaining" + remaining);
  state.append(dice(transition.end));
  footer.append(state);
}

function showSolution() {
  clearSteps();
  game.reset();
  var step = 1;
  game.solution.transitions.forEach(tr => {
    game.addTransition(tr);
    showStep(step++, tr, game.cost, game.remainingTargets.length);
  });
}

function resetGame() {
  clearSteps();
  game.reset();
}

$(document).ready(function() {
  newGame();
  $("#new").click(function() {
    newGame();
  });
  $("#solve").click(function() {
    showSolution();
  });
  $("#reset").click(function() {
    resetGame();
  });
});
    </script>
  </head>

  <body>
    <div id="game">
      <div id="cards">
        <div id="remove" class="category">
          <div id="c1" class="card"></div>
          <div id="c2" class="card"></div>
          <div id="c3" class="card"></div>
          <div id="c4" class="card"></div>
          <div id="c5" class="card"></div>
        </div>
        <div id="get" class="category">
          <div id="c6" class="card"></div>
          <div id="c7" class="card"></div>
          <div id="c8" class="card"></div>
          <div id="c9" class="card"></div>
          <div id="c10" class="card"></div>
        </div>
        <div id="change" class="category">
          <div id="c11" class="card"></div>
          <div id="c12" class="card"></div>
          <div id="c13" class="card"></div>
          <div id="c14" class="card"></div>
          <div id="c15" class="card"></div>
        </div>
      </div>
      <div id="goal">
        <div id="clay"></div>
        <div id="iron"></div>
        <div id="gold"></div>
      </div>
      <div id="actions">
        <div id="new" class="button">New Game</div>
        <div id="solve" class="button">Show Solution</div>
        <div id="reset" class="button">Reset Game</div>
      </div>
    </div>
  </body>
</html>
