<html>
  <head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous">
    </script>
    <script src="bundle.js"></script>
    <script>
var game;

function icon(id) {
  return "<svg><use xmlns:xlink='http://www.w3.org/1999/xlink' xlink:href='icons.xml#" + id + "'/></svg>";
}

function svg(dice) {
  var div = $("<div class='dice'></div>");
  var face1 = $("<div class='face1'></div>");
  xmlns:xlink="http://www.w3.org/1999/xlink"
  face1.append(icon("d" + dice.face1));
  div.append(face1);
  var face2 = $("<div class='face2'></div>");
  div.append(face2);
  if (dice.areTwo()) {
    face2.append(icon("d" + dice.face2));
  }
  return div;
}

function newGame() {
  clearSteps();
  game = new Game();
  var cnt = 1;
  game.operations.forEach(op => {
    var div = $("<div class='layout'></div>");
    var header = $("<div class='header'></div>");
    var main = $("<div class='main'></div>");
    var footer = $("<div class='footer'></div>");
    header.append("<div class='cost'>" + op.cost + "</div>");
    header.append("<div class='type'>" + op.type + "</div>");
    header.append("<div class='id'>" + op.id + "</div>");
    main.append("<div>" + op.description + "</div>");
    div.append(header);
    div.append(main);
    div.append(footer);
    $("#c" + cnt++).html(div);
  });
  $("#clay").html(svg(game.start));
  $("#iron").html(svg(game.targets[0]));
  $("#gold").html(svg(game.targets[1]));
}

function clearSteps() {
  for (var i = 1; i <= 15; i++) {
    $("#c" + i + " .footer").empty();
  }
}

function showStep(step, transition, cost, remaining) {
  var op = transition.operation;
  var card = game.operations.indexOf(op) + 1;
  var footer = $("#c" + card + " .footer");
  footer.append("<div class='cost'>" + cost + "</div>");
  footer.append("<div class='step'>" + step + "</div>");
  var state = $("<div class='state'></div>");
  state.addClass("remaining" + remaining);
  state.append(svg(transition.end));
  footer.append(state);
}

function showSolution() {
  clearSteps();
  game.reset();
  var step = 1;
  game.solution.transitions.forEach(tr => {
    game.addTransition(tr);
    showStep(step++, tr, game.cost, game.remainingTargets.length);
  });
}

function resetGame() {
  clearSteps();
  game.reset();
}

$(document).ready(function() {
  newGame();
  $("#new").click(function() {
    newGame();
  });
  $("#solve").click(function() {
    showSolution();
  });
  $("#reset").click(function() {
    resetGame();
  });
});
    </script>
  </head>

  <body>
    <div id="game">
      <div id="cards">
        <div id="remove" class="column">
          <div id="c1" class="card"></div>
          <div id="c2" class="card"></div>
          <div id="c3" class="card"></div>
          <div id="c4" class="card"></div>
          <div id="c5" class="card"></div>
        </div>
        <div id="get" class="column">
          <div id="c6" class="card"></div>
          <div id="c7" class="card"></div>
          <div id="c8" class="card"></div>
          <div id="c9" class="card"></div>
          <div id="c10" class="card"></div>
        </div>
        <div id="change" class="column">
          <div id="c11" class="card"></div>
          <div id="c12" class="card"></div>
          <div id="c13" class="card"></div>
          <div id="c14" class="card"></div>
          <div id="c15" class="card"></div>
        </div>
      </div>
      <div id="goal">
        <div id="clay"></div>
        <div id="iron"></div>
        <div id="gold"></div>
      </div>
      <div id="actions">
        <div id="new" class="button">New Game</div>
        <div id="solve" class="button">Show Solution</div>
        <div id="reset" class="button">Reset Game</div>
      </div>
    </div>
  </body>
</html>
